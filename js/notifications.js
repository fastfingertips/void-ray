/**
 * Void Ray - Notification System (ES6 Module)
 * In-game notifications, visual effects and achievement popups.
 */

/**
 * Text Notifications - Sends info messages to chat panel
 */
export function showNotification(planet, suffix) {
    let msg = "";
    let type = "loot";
    const name = planet.name || "";

    // Kategori Analizi
    if (name === "ROTA OLUŞTURULDU" || name.includes("OTOMATİK")) {
        msg = `Sistem: ${name}`;
        type = "info";
    } else if (name.includes("EVRİM GEÇİRİLDİ")) {
        msg = `Sistem: ${name}`;
        type = "info";
    } else if (name.includes("YANKI DOĞDU") || name.includes("YANKI AYRILDI") || name.includes("YANKI: ŞARJ") || name.includes("DEPO") || name.includes("GÖRÜŞ:")) {
        msg = `Sistem: ${name}`;
        type = "info";
    } else if (name.includes("ENERJİ") || name.includes("TARDİGRAD")) {
        msg = `${name} ${suffix}`;
        type = "info";
    } else if (name.includes("ZEHİR") || name.includes("TEHLİKE") || name.includes("YANKI ZEHİRLENDİ") || name.includes("DOLU") || name.includes("YETERSİZ") || name.includes("BAĞLANTI") || name.includes("BOŞ") || name.includes("ERİŞİM") || name.includes("HATA") || name.includes("SİNYAL KAYBI")) {
        msg = `UYARI: ${name} ${suffix}`;
        type = "alert";
    } else if (name.includes("KAYIP KARGO")) {
        msg = `Keşif: ${name} bulundu!`;
        type = "info";
    } else if (name.includes("SOLUCAN DELİĞİ")) { // YENİ
        msg = `UZAY-ZAMAN: ${name} ${suffix}`;
        type = "info";
    } else if (planet.type && (planet.type.id === 'common' || planet.type.id === 'rare' || planet.type.id === 'epic' || planet.type.id === 'legendary')) {
        msg = `Toplandı: ${name} ${suffix}`;
        type = "loot";
    } else {
        msg = `${name} ${suffix}`;
        type = "info";
    }

    // Chat Sistemine İlet
    if (typeof addChatMessage === 'function') {
        addChatMessage(msg, type, 'bilgi');
    }
}

/**
 * 2. GÖRSEL EFEKTLER (HUD OVERLAYS)
 */

/**
 * Ekranı yeşil renkte titreştirir (Zehir hasarı).
 */
export function showToxicEffect() {
    const el = document.getElementById('toxic-overlay');
    if (el) {
        el.classList.add('active');
        setTimeout(() => el.classList.remove('active'), 1500);
    }
}

/**
 * Ekranı kırmızı renkte titreştirir (Fiziksel hasar).
 */
export function showDamageEffect() {
    const dmgOverlay = document.getElementById('damage-overlay');
    if (dmgOverlay) {
        dmgOverlay.classList.add('active');
        setTimeout(() => dmgOverlay.classList.remove('active'), 200);
    }
}

/**
 * Ekranı bozar (Glitch) ve titretir. (Solucan Deliği Geçişi)
 * YENİ
 */
export function triggerWormholeEffect() {
    const el = document.getElementById('glitch-overlay');
    if (el) {
        el.classList.add('active');
        // Efekt süresi (Işınlanma animasyonu kadar)
        setTimeout(() => el.classList.remove('active'), 800);
    }
}

/**
 * 3. BAŞARIM POPUP'I
 * Sağ taraftan kayarak gelen başarım bildirimini gösterir.
 * @param {Object} ach - Başarım objesi {title, desc}
 */
export function showAchievementPopup(ach) {
    const container = document.getElementById('ui-core');
    if (!container) return;

    const popup = document.createElement('div');
    // CSS sınıfları css/hud.css dosyasında tanımlandı.
    popup.className = 'achievement-popup';
    popup.innerHTML = `
        <div class="ach-icon">★</div>
        <div class="ach-content">
            <div class="ach-title">BAŞARIM AÇILDI</div>
            <div class="ach-name">${ach.title}</div>
            <div class="ach-desc">${ach.desc}</div>
        </div>
    `;

    container.appendChild(popup);

    // Animasyonu tetiklemek için bir kare bekle
    requestAnimationFrame(() => {
        popup.classList.add('visible');
    });

    setTimeout(() => {
        popup.classList.remove('visible');
        setTimeout(() => popup.remove(), 600);
    }, 3000);
}

// Global erişimler
window.showNotification = showNotification;
window.showToxicEffect = showToxicEffect;
window.showDamageEffect = showDamageEffect;
window.showAchievementPopup = showAchievementPopup;
window.triggerWormholeEffect = triggerWormholeEffect;